<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weed Dispensary Simulator</title>
    <style>
        :root {
            --green-light: #8bc34a;
            --green-dark: #4a7023;
            --green-darker: #2d4216;
            --purple: #9c27b0;
            --orange: #ff9800;
            --red: #f44336;
            --blue: #2196f3;
            --brown: #795548;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background-color: #121212;
            color: #fff;
            margin: 0;
            padding: 0;
            background-image: 
                linear-gradient(rgba(20, 20, 20, 0.8), rgba(20, 20, 20, 0.8)),
                url('https://images.unsplash.com/photo-1516733968668-dbdce39c4651?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-attachment: fixed;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--green-dark);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            border: 2px solid var(--green-light);
            text-align: center;
            background-image: linear-gradient(to right, var(--green-dark), var(--green-darker));
        }
        
        h1 {
            margin: 0;
            color: white;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            letter-spacing: 2px;
            font-family: 'Impact', sans-serif;
        }
        
        .tagline {
            font-style: italic;
            color: #ddd;
            margin-top: 5px;
        }
        
        .game-area {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .game-area {
                grid-template-columns: 1fr;
            }
        }
        
        .player-panel {
            background-color: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--green-light);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(5px);
        }
        
        .stats {
            margin-bottom: 20px;
        }
        
        .stat {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 8px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            border-left: 3px solid var(--green-light);
        }
        
        .stat-label {
            font-weight: bold;
        }
        
        .stat-value {
            font-weight: bold;
        }
        
        .money {
            color: var(--orange);
        }
        
        .highness {
            color: var(--purple);
        }
        
        .stamina {
            color: var(--blue);
        }
        
        .tolerance {
            color: var(--green-light);
        }
        
        .reputation {
            color: var(--red);
        }
        
        .actions {
            margin-top: 20px;
        }
        
        .btn {
            background-color: var(--green-dark);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px 0;
            width: 100%;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .btn:hover {
            background-color: var(--green-light);
            transform: translateY(-2px);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-work {
            background-color: var(--blue);
        }
        
        .btn-rest {
            background-color: var(--purple);
        }
        
        .btn-danger {
            background-color: var(--red);
        }
        
        .btn-special {
            background-color: var(--orange);
        }
        
        .store {
            background-color: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--green-light);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(5px);
        }
        
        .store-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--green-light);
        }
        
        .tabs {
            display: flex;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 8px 15px;
            cursor: pointer;
            background-color: var(--green-darker);
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
            transition: all 0.3s;
            margin-bottom: 5px;
        }
        
        .tab.active {
            background-color: var(--green-dark);
            font-weight: bold;
        }
        
        .tab:hover:not(.active) {
            background-color: var(--green-dark);
        }
        
        .products {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .product {
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid var(--green-light);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .product:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .product-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--green-light);
        }
        
        .product-price {
            color: var(--orange);
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .product-effects {
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .product-effect {
            display: flex;
            justify-content: space-between;
            margin-bottom: 3px;
        }
        
        .product-btn {
            background-color: var(--green-dark);
            color: white;
            border: none;
            padding: 8px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .product-btn:hover {
            background-color: var(--green-light);
        }
        
        .product-stock {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 3px 6px;
            border-radius: 10px;
            font-size: 0.8rem;
        }
        
        .inventory {
            margin-top: 20px;
        }
        
        .inventory-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
        }
        
        .inventory-item {
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 10px;
            border: 1px solid var(--green-light);
            transition: all 0.3s;
        }
        
        .inventory-item:hover {
            transform: scale(1.05);
        }
        
        .log {
            margin-top: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--green-light);
            height: 150px;
            overflow-y: auto;
            backdrop-filter: blur(5px);
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding-bottom: 5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
        }
        
        .log-time {
            color: #aaa;
            font-size: 0.8rem;
            margin-right: 5px;
        }
        
        .high-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.5s;
            background: radial-gradient(circle, rgba(156, 39, 176, 0.2) 0%, transparent 70%);
        }
        
        .high-text {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            color: white;
            text-shadow: 0 0 10px var(--purple);
            opacity: 0;
            pointer-events: none;
            z-index: 101;
            animation: float 3s infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translate(-50%, -50%) rotate(-5deg); }
            50% { transform: translate(-50%, -60%) rotate(5deg); }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--green-dark);
            color: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transform: translateX(200%);
            transition: transform 0.3s;
            z-index: 1000;
            max-width: 300px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .dealership {
            background-color: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--green-light);
            margin-top: 20px;
            backdrop-filter: blur(5px);
        }
        
        .upgrades {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .upgrade {
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid var(--green-light);
        }
        
        .upgrade-name {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--orange);
        }
        
        .badge {
            display: inline-block;
            padding: 2px 5px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 5px;
        }
        
        .badge-new {
            background-color: var(--red);
            color: white;
        }
        
        .badge-sale {
            background-color: var(--orange);
            color: black;
        }
        
        .store-hours {
            font-size: 0.8rem;
            color: #aaa;
        }
        
        .progress-bar {
            height: 5px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--green-light);
            width: 0%;
            transition: width 0.3s;
        }
        
        .addiction-meter {
            margin-top: 10px;
            font-size: 0.8rem;
        }
        
        .addiction-level {
            color: var(--red);
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="high-effect" id="highEffect"></div>
    <div class="high-text" id="highText">SO HIGH...</div>
    
    <div class="container">
        <header>
            <h1>DANK DISPENSARY</h1>
            <div class="tagline">"Your one-stop shop for the finest herbs"</div>
        </header>
        
        <div class="game-area">
            <div class="player-panel">
                <div class="stats">
                    <div class="stat">
                        <span class="stat-label">Cash:</span>
                        <span class="stat-value money" id="money">$100</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Highness:</span>
                        <span class="stat-value highness" id="highness">0%</span>
                        <div class="progress-bar">
                            <div class="progress-fill" id="highness-bar"></div>
                        </div>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Stamina:</span>
                        <span class="stat-value stamina" id="stamina">100%</span>
                        <div class="progress-bar">
                            <div class="progress-fill" id="stamina-bar"></div>
                        </div>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Tolerance:</span>
                        <span class="stat-value tolerance" id="tolerance">0%</span>
                        <div class="progress-bar">
                            <div class="progress-fill" id="tolerance-bar"></div>
                        </div>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Reputation:</span>
                        <span class="stat-value reputation" id="reputation">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Day:</span>
                        <span class="stat-value" id="day">1</span>
                    </div>
                    <div class="addiction-meter">
                        <span>Addiction Level: </span>
                        <span class="addiction-level" id="addiction">None</span>
                    </div>
                </div>
                
                <div class="actions">
                    <button class="btn btn-work" onclick="work()">Work Shift ($75)</button>
                    <button class="btn btn-rest" onclick="rest()">Take a Nap</button>
                    <button class="btn" onclick="smokeRandom()">Smoke Random</button>
                    <button class="btn btn-danger" onclick="soberUp()">Sober Up ($20)</button>
                    <button class="btn btn-special" onclick="nextDay()">Next Day</button>
                </div>
                
                <div class="inventory">
                    <h3>Your Stash <small>(<span id="inventory-count">0</span>/<span id="inventory-capacity">20</span>)</small></h3>
                    <div class="inventory-items" id="inventory">
                        <div style="grid-column: 1 / -1; text-align: center; padding: 20px;">Your stash is empty</div>
                    </div>
                </div>
            </div>
            
            <div class="store">
                <div class="store-header">
                    <h2>Product Menu</h2>
                    <div>
                        <div id="store-status">Open</div>
                        <div class="store-hours" id="store-hours">Closes in 8 hours</div>
                    </div>
                </div>
                
                <div class="tabs">
                    <div class="tab active" onclick="openTab('flower')">Flower</div>
                    <div class="tab" onclick="openTab('concentrates')">Concentrates</div>
                    <div class="tab" onclick="openTab('edibles')">Edibles</div>
                    <div class="tab" onclick="openTab('upgrades')">Upgrades</div>
                </div>
                
                <div id="flower" class="tab-content active">
                    <div class="products" id="flower-products">
                        <!-- Flower products will be added here -->
                    </div>
                </div>
                
                <div id="concentrates" class="tab-content">
                    <div class="products" id="concentrate-products">
                        <!-- Concentrate products will be added here -->
                    </div>
                </div>
                
                <div id="edibles" class="tab-content">
                    <div class="products" id="edible-products">
                        <!-- Edible products will be added here -->
                    </div>
                </div>
                
                <div id="upgrades" class="tab-content">
                    <div class="upgrades" id="upgrade-items">
                        <!-- Upgrades will be added here -->
                    </div>
                </div>
            </div>
        </div>
        
        <div class="log" id="log">
            <h3>Dispensary Log</h3>
            <div id="log-entries">
                <div class="log-entry"><span class="log-time">[Day 1]</span> Welcome to Dank Dispensary!</div>
            </div>
        </div>
        
        <div class="dealership" id="dealership" style="display: none;">
            <h2>Dealership Opportunities <span class="badge badge-new">NEW</span></h2>
            <p>You've built up enough reputation to buy in bulk!</p>
            <div class="products" id="bulk-products">
                <!-- Bulk products will be added here -->
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification">
        <div id="notification-message"></div>
    </div>
    
    <audio id="cashSound" src="https://www.soundjay.com/buttons/sounds/button-09.mp3" preload="auto"></audio>
    <audio id="smokeSound" src="https://www.soundjay.com/buttons/sounds/button-10.mp3" preload="auto"></audio>
    
    <script>
        // Game state
        const gameState = {
            money: 100,
            highness: 0,
            stamina: 100,
            tolerance: 0,
            day: 1,
            reputation: 0,
            inventory: {},
            ownedUpgrades: [],
            storeOpen: true,
            lastSmoked: null,
            storeHoursLeft: 8,
            addictionLevel: 0,
            inventoryCapacity: 20,
            dailyEarnings: 0,
            
            products: {
                flower: [
                    {
                        id: 'reggie',
                        name: 'Reggie',
                        price: 15,
                        effect: { high: 10, stamina: -5, tolerance: 2, addiction: 1 },
                        description: 'Basic brick weed',
                        stock: 10,
                        popularity: 1
                    },
                    {
                        id: 'mids',
                        name: 'Mids',
                        price: 30,
                        effect: { high: 20, stamina: -8, tolerance: 3, addiction: 2 },
                        description: 'Decent quality',
                        stock: 8,
                        popularity: 2
                    },
                    {
                        id: 'dank',
                        name: 'Dank OG',
                        price: 60,
                        effect: { high: 35, stamina: -12, tolerance: 5, addiction: 3 },
                        description: 'Top shelf flower',
                        stock: 6,
                        popularity: 3
                    },
                    {
                        id: 'exotic',
                        name: 'Exotic',
                        price: 100,
                        effect: { high: 50, stamina: -15, tolerance: 7, addiction: 4 },
                        description: 'Rare designer strain',
                        stock: 4,
                        popularity: 4
                    },
                    {
                        id: 'moonrocks',
                        name: 'Moon Rocks',
                        price: 200,
                        effect: { high: 70, stamina: -20, tolerance: 10, addiction: 5 },
                        description: 'The ultimate experience',
                        stock: 2,
                        popularity: 5
                    }
                ],
                
                concentrates: [
                    {
                        id: 'kief',
                        name: 'Kief',
                        price: 40,
                        effect: { high: 30, stamina: -10, tolerance: 6, addiction: 3 },
                        description: 'Pure trichomes',
                        stock: 8,
                        popularity: 2
                    },
                    {
                        id: 'hash',
                        name: 'Hash',
                        price: 80,
                        effect: { high: 45, stamina: -15, tolerance: 8, addiction: 4 },
                        description: 'Traditional concentrate',
                        stock: 6,
                        popularity: 3
                    },
                    {
                        id: 'wax',
                        name: 'Live Resin',
                        price: 120,
                        effect: { high: 60, stamina: -18, tolerance: 10, addiction: 5 },
                        description: 'Premium extract',
                        stock: 4,
                        popularity: 4
                    },
                    {
                        id: 'shatter',
                        name: 'Diamonds',
                        price: 200,
                        effect: { high: 80, stamina: -25, tolerance: 15, addiction: 6 },
                        description: '99% pure THC',
                        stock: 2,
                        popularity: 5
                    }
                ],
                
                edibles: [
                    {
                        id: 'gummy',
                        name: 'Gummy Bears',
                        price: 25,
                        effect: { high: 40, stamina: -5, tolerance: 5, addiction: 2 },
                        description: 'Slow but long-lasting',
                        stock: 10,
                        delayed: true,
                        popularity: 2
                    },
                    {
                        id: 'brownie',
                        name: 'Space Brownie',
                        price: 50,
                        effect: { high: 60, stamina: -8, tolerance: 8, addiction: 3 },
                        description: 'Powerful edible',
                        stock: 6,
                        delayed: true,
                        popularity: 3
                    },
                    {
                        id: 'drink',
                        name: 'THC Soda',
                        price: 40,
                        effect: { high: 50, stamina: -6, tolerance: 6, addiction: 3 },
                        description: 'Fast-acting drink',
                        stock: 8,
                        delayed: false,
                        popularity: 3
                    }
                ]
            },
            
            upgrades: [
                {
                    id: 'stashbox',
                    name: 'Stash Box',
                    price: 200,
                    description: 'Increases inventory capacity by 10',
                    effect: 'capacity'
                },
                {
                    id: 'grinder',
                    name: 'Premium Grinder',
                    price: 150,
                    description: 'Get 10% more from your flower',
                    effect: 'efficiency'
                },
                {
                    id: 'vape',
                    name: 'Dry Herb Vape',
                    price: 300,
                    description: 'Reduces stamina loss by 25%',
                    effect: 'health'
                },
                {
                    id: 'dealer',
                    name: 'Connect',
                    price: 500,
                    description: 'Access to bulk purchases',
                    effect: 'bulk'
                },
                {
                    id: 'business',
                    name: 'Business License',
                    price: 1000,
                    description: 'Earn 20% more from work',
                    effect: 'earnings'
                }
            ],
            
            bulkDeals: [
                {
                    id: 'oz_reggie',
                    name: 'Oz of Reggie',
                    price: 250,
                    quantity: 28,
                    product: 'reggie',
                    description: '28g of basic flower',
                    reputationReq: 5
                },
                {
                    id: 'oz_mids',
                    name: 'Oz of Mids',
                    price: 500,
                    quantity: 28,
                    product: 'mids',
                    description: '28g of decent flower',
                    reputationReq: 10
                },
                {
                    id: 'half_dank',
                    name: 'Half Oz of Dank',
                    price: 750,
                    quantity: 14,
                    product: 'dank',
                    description: '14g of premium flower',
                    reputationReq: 15
                },
                {
                    id: 'quarter_exotic',
                    name: 'Quarter Oz of Exotic',
                    price: 1000,
                    quantity: 7,
                    product: 'exotic',
                    description: '7g of rare designer strain',
                    reputationReq: 20
                }
            ]
        };

        // Initialize the game
        function init() {
            updateStats();
            renderProducts();
            renderUpgrades();
            renderInventory();
            
            // Check for highness effect every second
            setInterval(updateHighEffect, 100);
            
            // Update store hours every minute
            setInterval(updateStoreHours, 60000);
            
            // Restock store every 3 days
            if (gameState.day % 3 === 0) {
                restockStore();
            }
        }

        // Update all displayed stats
        function updateStats() {
            document.getElementById('money').textContent = `$${gameState.money}`;
            document.getElementById('highness').textContent = `${gameState.highness}%`;
            document.getElementById('stamina').textContent = `${gameState.stamina}%`;
            document.getElementById('tolerance').textContent = `${gameState.tolerance}%`;
            document.getElementById('day').textContent = gameState.day;
            document.getElementById('reputation').textContent = gameState.reputation;
            
            // Update progress bars
            document.getElementById('highness-bar').style.width = `${gameState.highness}%`;
            document.getElementById('stamina-bar').style.width = `${gameState.stamina}%`;
            document.getElementById('tolerance-bar').style.width = `${gameState.tolerance}%`;
            
            // Update store status
            const statusElement = document.getElementById('store-status');
            statusElement.textContent = gameState.storeOpen ? 'Open' : 'Closed';
            statusElement.style.color = gameState.storeOpen ? 'var(--green-light)' : 'var(--red)';
            
            // Update store hours
            document.getElementById('store-hours').textContent = gameState.storeOpen 
                ? `Closes in ${gameState.storeHoursLeft} hours` 
                : `Opens in ${8 - gameState.storeHoursLeft} hours`;
            
            // Show/hide dealership based on upgrades
            const hasDealer = gameState.ownedUpgrades.includes('dealer');
            document.getElementById('dealership').style.display = hasDealer ? 'block' : 'none';
            
            if (hasDealer) {
                renderBulkDeals();
            }
            
            // Update inventory count
            const totalItems = Object.values(gameState.inventory).reduce((sum, qty) => sum + qty, 0);
            document.getElementById('inventory-count').textContent = totalItems;
            document.getElementById('inventory-capacity').textContent = gameState.inventoryCapacity;
            
            // Update addiction level
            let addictionText = '';
            if (gameState.addictionLevel < 10) {
                addictionText = 'None';
            } else if (gameState.addictionLevel < 30) {
                addictionText = 'Low';
            } else if (gameState.addictionLevel < 60) {
                addictionText = 'Moderate';
            } else if (gameState.addictionLevel < 90) {
                addictionText = 'High';
            } else {
                addictionText = 'Severe';
            }
            document.getElementById('addiction').textContent = addictionText;
        }

        // Render all products
        function renderProducts() {
            renderProductCategory('flower');
            renderProductCategory('concentrates');
            renderProductCategory('edibles');
        }

        // Render products for a specific category
        function renderProductCategory(category) {
            const container = document.getElementById(`${category}-products`);
            container.innerHTML = '';
            
            gameState.products[category].forEach(product => {
                const productElement = document.createElement('div');
                productElement.className = 'product';
                
                // Check if product is popular (for visual flair)
                const isPopular = product.popularity >= 4;
                const isOnSale = Math.random() > 0.8 && gameState.day > 3;
                
                productElement.innerHTML = `
                    <div class="product-name">${product.name}${isPopular ? ' ★' : ''}</div>
                    ${isOnSale ? '<div class="badge badge-sale">SALE</div>' : ''}
                    <div class="product-price">$${isOnSale ? Math.floor(product.price * 0.8) : product.price}</div>
                    <div class="product-effects">
                        <div class="product-effect">
                            <span>High:</span>
                            <span>+${product.effect.high}%</span>
                        </div>
                        <div class="product-effect">
                            <span>Stamina:</span>
                            <span>${product.effect.stamina}%</span>
                        </div>
                        <div class="product-effect">
                            <span>Tolerance:</span>
                            <span>+${product.effect.tolerance}%</span>
                        </div>
                    </div>
                    <div class="product-description">${product.description}</div>
                    <div class="product-stock">${product.stock}g left</div>
                    <button class="product-btn" onclick="buyProduct('${category}', '${product.id}', ${isOnSale})">
                        Buy 1g ${isOnSale ? '(-20%)' : ''}
                    </button>
                `;
                
                container.appendChild(productElement);
            });
        }

        // Render bulk deals
        function renderBulkDeals() {
            const container = document.getElementById('bulk-products');
            container.innerHTML = '';
            
            gameState.bulkDeals.forEach(deal => {
                // Check if player meets reputation requirement
                const canBuy = gameState.reputation >= deal.reputationReq;
                
                const dealElement = document.createElement('div');
                dealElement.className = 'product';
                dealElement.style.opacity = canBuy ? '1' : '0.6';
                
                dealElement.innerHTML = `
                    <div class="product-name">${deal.name}</div>
                    <div class="product-price">$${deal.price}</div>
                    <div class="product-effects">
                        <div class="product-effect">
                            <span>Quantity:</span>
                            <span>${deal.quantity}g</span>
                        </div>
                        <div class="product-effect">
                            <span>Reputation:</span>
                            <span>${deal.reputationReq}+</span>
                        </div>
                    </div>
                    <div class="product-description">${deal.description}</div>
                    <button class="product-btn" onclick="${canBuy ? `buyBulkDeal('${deal.id}')` : ''}" 
                        ${!canBuy ? 'disabled style="background-color: #555;"' : ''}>
                        ${canBuy ? 'Purchase' : 'Need Rep ' + deal.reputationReq}
                    </button>
                `;
                
                container.appendChild(dealElement);
            });
        }

        // Render upgrades
        function renderUpgrades() {
            const container = document.getElementById('upgrade-items');
            container.innerHTML = '';
            
            gameState.upgrades.forEach(upgrade => {
                const owned = gameState.ownedUpgrades.includes(upgrade.id);
                const upgradeElement = document.createElement('div');
                upgradeElement.className = 'upgrade';
                
                upgradeElement.innerHTML = `
                    <div class="upgrade-name">${upgrade.name}</div>
                    <div class="product-price">$${upgrade.price}</div>
                    <div class="product-description">${upgrade.description}</div>
                    <button class="product-btn" 
                            onclick="${owned ? '' : `buyUpgrade('${upgrade.id}')`}" 
                            ${owned ? 'disabled style="background-color: #555;"' : ''}>
                        ${owned ? 'Owned' : 'Purchase'}
                    </button>
                `;
                
                container.appendChild(upgradeElement);
            });
        }

        // Render inventory
        function renderInventory() {
            const container = document.getElementById('inventory');
            container.innerHTML = '';
            
            const totalItems = Object.values(gameState.inventory).reduce((sum, qty) => sum + qty, 0);
            
            if (totalItems === 0) {
                container.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 20px;">Your stash is empty</div>';
                return;
            }
            
            for (const [productId, quantity] of Object.entries(gameState.inventory)) {
                if (quantity > 0) {
                    // Find the product details
                    let product = null;
                    let category = null;
                    
                    // Check all categories
                    for (const cat of ['flower', 'concentrates', 'edibles']) {
                        const found = gameState.products[cat].find(p => p.id === productId);
                        if (found) {
                            product = found;
                            category = cat;
                            break;
                        }
                    }
                    
                    // Also check bulk deals
                    if (!product) {
                        const found = gameState.bulkDeals.find(d => d.product === productId);
                        if (found) {
                            product = {
                                name: found.name.replace(/Oz of |Half |Quarter /, ''),
                                effect: gameState.products.flower.find(p => p.id === found.product)?.effect
                            };
                            category = 'bulk';
                        }
                    }
                    
                    if (product) {
                        const itemElement = document.createElement('div');
                        itemElement.className = 'inventory-item';
                        
                        itemElement.innerHTML = `
                            <div style="font-weight: bold; color: var(--green-light);">${product.name}</div>
                            <div>${quantity}g</div>
                            <button class="product-btn" style="padding: 5px; font-size: 0.8rem;" onclick="smokeWeed('${productId}', '${category}')">
                                Use
                            </button>
                        `;
                        
                        container.appendChild(itemElement);
                    }
                }
            }
        }

        // Buy a product
        function buyProduct(category, productId, isOnSale = false) {
            if (!gameState.storeOpen) {
                showNotification("The store is closed! Come back tomorrow.");
                return;
            }
            
            const product = gameState.products[category].find(p => p.id === productId);
            
            if (!product) {
                showNotification("Product not available");
                return;
            }
            
            if (product.stock <= 0) {
                showNotification("Out of stock!");
                return;
            }
            
            const price = isOnSale ? Math.floor(product.price * 0.8) : product.price;
            
            // Check inventory capacity
            const totalItems = Object.values(gameState.inventory).reduce((sum, qty) => sum + qty, 0);
            if (totalItems >= gameState.inventoryCapacity) {
                showNotification("Your stash is full! Upgrade your capacity.");
                return;
            }
            
            if (gameState.money >= price) {
                gameState.money -= price;
                product.stock -= 1;
                
                if (!gameState.inventory[productId]) {
                    gameState.inventory[productId] = 0;
                }
                gameState.inventory[productId] += 1;
                
                playSound('cashSound');
                addLog(`Purchased 1g of ${product.name} for $${price}`);
                updateStats();
                renderInventory();
                renderProducts();
                showNotification(`Added ${product.name} to your stash`);
            } else {
                showNotification("Not enough money!");
            }
        }

        // Buy a bulk deal
        function buyBulkDeal(dealId) {
            const deal = gameState.bulkDeals.find(d => d.id === dealId);
            
            if (!deal) {
                showNotification("Deal not available");
                return;
            }
            
            // Check inventory capacity
            const totalItems = Object.values(gameState.inventory).reduce((sum, qty) => sum + qty, 0);
            if (totalItems + deal.quantity > gameState.inventoryCapacity) {
                showNotification("Not enough space in your stash!");
                return;
            }
            
            if (gameState.money >= deal.price) {
                gameState.money -= deal.price;
                
                if (!gameState.inventory[deal.product]) {
                    gameState.inventory[deal.product] = 0;
                }
                gameState.inventory[deal.product] += deal.quantity;
                
                playSound('cashSound');
                addLog(`Purchased ${deal.name} for $${deal.price}`);
                updateStats();
                renderInventory();
                showNotification(`Added ${deal.quantity}g to your stash`);
            } else {
                showNotification("Not enough money for this deal!");
            }
        }

        // Buy an upgrade
        function buyUpgrade(upgradeId) {
            const upgrade = gameState.upgrades.find(u => u.id === upgradeId);
            
            if (!upgrade) {
                showNotification("Upgrade not available");
                return;
            }
            
            if (gameState.money >= upgrade.price) {
                gameState.money -= upgrade.price;
                gameState.ownedUpgrades.push(upgradeId);
                
                // Apply upgrade effects
                switch(upgrade.effect) {
                    case 'capacity':
                        gameState.inventoryCapacity += 10;
                        break;
                    case 'efficiency':
                        // Handled in smokeWeed function
                        break;
                    case 'health':
                        // Handled in smokeWeed function
                        break;
                    case 'bulk':
                        // Handled in renderBulkDeals
                        break;
                    case 'earnings':
                        // Handled in work function
                        break;
                }
                
                playSound('cashSound');
                addLog(`Purchased ${upgrade.name} upgrade for $${upgrade.price}`);
                updateStats();
                renderUpgrades();
                showNotification(`Upgrade acquired: ${upgrade.name}`);
                
                // Special effects for certain upgrades
                if (upgradeId === 'dealer') {
                    renderBulkDeals();
                }
            } else {
                showNotification("Not enough money for this upgrade!");
            }
        }

        // Smoke/consume weed
        function smokeWeed(productId, category) {
            if (!gameState.inventory[productId] || gameState.inventory[productId] <= 0) {
                showNotification("You don't have any of this left!");
                return;
            }
            
            // Find the product
            let product = null;
            
            if (category === 'bulk') {
                // For bulk deals, find the original product
                const deal = gameState.bulkDeals.find(d => d.id === productId);
                if (deal) {
                    for (const cat of ['flower', 'concentrates', 'edibles']) {
                        const found = gameState.products[cat].find(p => p.id === deal.product);
                        if (found) {
                            product = found;
                            break;
                        }
                    }
                }
            } else {
                product = gameState.products[category].find(p => p.id === productId);
            }
            
            if (!product) {
                showNotification("Invalid product");
                return;
            }
            
            // Check if you've smoked too recently
            const now = new Date();
            if (gameState.lastSmoked && (now - gameState.lastSmoked) < 30000) { // 30 seconds
                showNotification("You need to wait before smoking again!");
                return;
            }
            
            // Apply effects
            gameState.inventory[productId] -= 1;
            
            // Calculate actual high with tolerance
            let effectiveHigh = Math.max(5, product.effect.high - (gameState.tolerance / 2));
            let staminaEffect = product.effect.stamina;
            
            // Apply upgrade effects
            if (gameState.ownedUpgrades.includes('grinder')) {
                // Grinder makes flower more effective
                if (category === 'flower') {
                    effectiveHigh = Math.min(100, effectiveHigh * 1.1);
                }
            }
            
            if (gameState.ownedUpgrades.includes('vape')) {
                // Vape reduces stamina loss
                if (category === 'flower' || category === 'concentrates') {
                    staminaEffect = staminaEffect * 0.75;
                }
            }
            
            gameState.highness = Math.min(100, gameState.highness + effectiveHigh);
            gameState.stamina = Math.max(0, gameState.stamina + staminaEffect);
            gameState.tolerance = Math.min(100, gameState.tolerance + product.effect.tolerance);
            gameState.addictionLevel = Math.min(100, gameState.addictionLevel + product.effect.addiction);
            gameState.lastSmoked = now;
            gameState.reputation += 1;
            
            playSound('smokeSound');
            
            // Random messages based on highness
            let message = `You consumed ${product.name}. Feeling ${Math.round(effectiveHigh)}% higher!`;
            
            if (gameState.highness >= 90) {
                message += " DUDE... YOU'RE IN SPACE...";
            } else if (gameState.highness >= 70) {
                message += " Whoa... everything is wavy...";
            } else if (gameState.highness >= 50) {
                message += " Nice buzz going on...";
            }
            
            if (gameState.stamina <= 20) {
                message += " You're exhausted...";
            }
            
            if (gameState.addictionLevel >= 90) {
                message += " You really need this...";
            } else if (gameState.addictionLevel >= 60) {
                message += " You're craving more...";
            }
            
            addLog(message);
            updateStats();
            renderInventory();
        }

        // Work to earn money
        function work() {
            if (gameState.highness > 40) {
                showNotification("You're too high to work properly!");
                addLog("You tried to work but were too stoned to be productive.");
                return;
            }
            
            if (gameState.stamina < 30) {
                showNotification("You're too tired to work!");
                addLog("You're exhausted and need to rest before working.");
                return;
            }
            
            let earnings = 75;
            
            // Apply business license upgrade
            if (gameState.ownedUpgrades.includes('business')) {
                earnings = Math.floor(earnings * 1.2);
            }
            
            gameState.money += earnings;
            gameState.dailyEarnings += earnings;
            gameState.stamina = Math.max(0, gameState.stamina - 25);
            gameState.highness = Math.max(0, gameState.highness - 10);
            
            playSound('cashSound');
            addLog(`You worked a shift and earned $${earnings}.`);
            updateStats();
            showNotification(`Earned $${earnings} from work`);
        }

        // Rest to recover stamina
        function rest() {
            const recovery = 40;
            gameState.stamina = Math.min(100, gameState.stamina + recovery);
            gameState.highness = Math.max(0, gameState.highness - 15);
            gameState.tolerance = Math.max(0, gameState.tolerance - 5);
            
            addLog(`You took a nap and recovered ${recovery}% stamina.`);
            updateStats();
            showNotification("You feel refreshed after resting");
        }

        // Sober up
        function soberUp() {
            if (gameState.money < 20) {
                showNotification("You need $20 to sober up!");
                return;
            }
            
            gameState.money -= 20;
            gameState.highness = Math.max(0, gameState.highness - 30);
            gameState.tolerance = Math.max(0, gameState.tolerance - 10);
            gameState.addictionLevel = Math.max(0, gameState.addictionLevel - 5);
            
            addLog("You paid $20 to sober up a bit.");
            updateStats();
            showNotification("You feel more clear-headed now");
        }

        // Smoke a random weed from inventory
        function smokeRandom() {
            const available = Object.keys(gameState.inventory).filter(id => gameState.inventory[id] > 0);
            
            if (available.length === 0) {
                showNotification("You don't have any weed to smoke!");
                return;
            }
            
            const randomId = available[Math.floor(Math.random() * available.length)];
            
            // Determine category
            let category = null;
            for (const cat of ['flower', 'concentrates', 'edibles']) {
                const found = gameState.products[cat].find(p => p.id === randomId);
                if (found) {
                    category = cat;
                    break;
                }
            }
            
            if (!category) {
                // Check if it's a bulk deal
                const deal = gameState.bulkDeals.find(d => d.id === randomId);
                if (deal) {
                    for (const cat of ['flower', 'concentrates', 'edibles']) {
                        const found = gameState.products[cat].find(p => p.id === deal.product);
                        if (found) {
                            category = 'bulk';
                            break;
                        }
                    }
                }
            }
            
            if (category) {
                smokeWeed(randomId, category);
            } else {
                showNotification("Couldn't find that product");
            }
        }

        // Advance to next day
        function nextDay() {
            gameState.day += 1;
            gameState.storeHoursLeft = 8;
            gameState.storeOpen = true;
            gameState.dailyEarnings = 0;
            
            // Natural recovery
            gameState.stamina = Math.min(100, gameState.stamina + 20);
            gameState.highness = Math.max(0, gameState.highness - 15);
            gameState.tolerance = Math.max(0, gameState.tolerance - 5);
            
            // Withdrawal effects if addicted
            if (gameState.addictionLevel >= 60) {
                const withdrawal = Math.floor(gameState.addictionLevel / 10);
                gameState.stamina = Math.max(0, gameState.stamina - withdrawal);
                gameState.highness = Math.max(0, gameState.highness - withdrawal);
                addLog(`You feel withdrawal effects (-${withdrawal}% stamina/highness)`);
            }
            
            // Restock store every 3 days
            if (gameState.day % 3 === 0) {
                restockStore();
            }
            
            addLog(`Day ${gameState.day} begins.`);
            updateStats();
            renderProducts();
            showNotification("A new day begins!");
        }

        // Restock the store
        function restockStore() {
            for (const category of ['flower', 'concentrates', 'edibles']) {
                gameState.products[category].forEach(product => {
                    product.stock = Math.min(
                        product.stock + Math.floor(product.popularity * 2),
                        product.popularity * 4
                    );
                });
            }
            
            addLog("The dispensary restocked its products.");
            renderProducts();
        }

        // Update store hours
        function updateStoreHours() {
            if (gameState.storeOpen) {
                gameState.storeHoursLeft -= 1;
                
                if (gameState.storeHoursLeft <= 0) {
                    gameState.storeOpen = false;
                    addLog("The dispensary has closed for the day.");
                }
            } else {
                gameState.storeHoursLeft += 1;
                
                if (gameState.storeHoursLeft >= 8) {
                    gameState.storeOpen = true;
                    gameState.storeHoursLeft = 8;
                    addLog("The dispensary has opened for business.");
                }
            }
            
            updateStats();
        }

        // Update highness visual effect
        function updateHighEffect() {
            const effect = document.getElementById('highEffect');
            const text = document.getElementById('highText');
            
            if (gameState.highness > 70) {
                effect.style.opacity = (gameState.highness - 70) / 30;
                text.style.opacity = (gameState.highness - 70) / 30;
            } else {
                effect.style.opacity = 0;
                text.style.opacity = 0;
            }
        }

        // Add a message to the log
        function addLog(message) {
            const logEntries = document.getElementById('log-entries');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `<span class="log-time">[Day ${gameState.day}]</span> ${message}`;
            logEntries.appendChild(entry);
            logEntries.scrollTop = logEntries.scrollHeight;
        }

        // Show a notification
        function showNotification(message) {
            const notification = document.getElementById('notification');
            const messageEl = document.getElementById('notification-message');
            
            messageEl.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Play a sound
        function playSound(id) {
            const sound = document.getElementById(id);
            sound.currentTime = 0;
            sound.play();
        }

        // Tab switching
        function openTab(tabName) {
            const tabContents = document.querySelectorAll('.tab-content');
            const tabs = document.querySelectorAll('.tab');
            
            tabContents.forEach(content => {
                content.classList.remove('active');
            });
            
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        // Start the game when page loads
        window.onload = init;
    </script>
</body>
</html>
